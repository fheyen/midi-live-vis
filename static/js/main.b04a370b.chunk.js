(this["webpackJsonpmidi-live-vis"]=this["webpackJsonpmidi-live-vis"]||[]).push([[0],{22:function(t,e,i){},28:function(t,e,i){"use strict";i.r(e);var s=i(0),n=i(2),a=i.n(n),o=i(11),h=i.n(o),r=(i(22),i(39)),c=i(35),l=i(41),d=i(9),m=i(38),u=i(3),w=i(5);class p extends n.PureComponent{constructor(t,e={top:0,right:0,bottom:0,left:0},i=1,n=1,a=!0,o=!0){super(t),this.onResize=()=>{},this.increaseRows=()=>{const{rowSpan:t,rowlimit:e,margin:i,canResizeRows:s}=this.state,{outerHeight:n}=this.props.viewSize;if(!s)return;if(t>=e)return;const a=t+1,o=n*a;this.setState({rowSpan:a,viewHeight:o,height:o-i.top-i.bottom},this.onResize)},this.decreaseRows=()=>{const{rowSpan:t,margin:e,canResizeRows:i}=this.state,{outerHeight:s}=this.props.viewSize;if(!i)return;if(t<=1)return;const n=t-1,a=s*n;this.setState({rowSpan:n,viewHeight:a,height:a-e.top-e.bottom},this.onResize)},this.increaseColumns=()=>{const{columnSpan:t,columnLimit:e,margin:i,canResizeColumns:s}=this.state,{outerWidth:n}=this.props.viewSize;if(!s)return;if(t>=e)return;const a=t+1,o=n*a;this.setState({columnSpan:a,viewWidth:o,width:o-i.left-i.right},this.onResize)},this.decreaseColumns=()=>{const{columnSpan:t,margin:e,canResizeColumns:i}=this.state,{outerWidth:s}=this.props.viewSize;if(!i)return;if(t<=1)return;const n=t-1,a=s*n;this.setState({columnSpan:n,viewWidth:a,width:a-e.left-e.right},this.onResize)},this.close=()=>{const{toggleView:t,name:e}=this.props;t&&e&&t(e)},this.getSizeControlHTML=()=>Object(s.jsxs)("div",{className:"sizeControl",children:[this.state.canResizeRows&&Object(s.jsxs)("span",{children:[Object(s.jsx)("button",{onClick:this.increaseRows,title:"Increase rows",disabled:this.state.rowSpan>=this.state.rowlimit,children:Object(s.jsx)(u.a,{icon:w.b})}),Object(s.jsx)("button",{onClick:this.decreaseRows,title:"Decrease rows",disabled:this.state.rowSpan<=1,children:Object(s.jsx)(u.a,{icon:w.d})})]}),this.state.canResizeColumns&&Object(s.jsxs)("span",{children:[Object(s.jsx)("button",{onClick:this.increaseColumns,title:"Increase columns",disabled:this.state.columnSpan>=this.state.columnLimit,children:Object(s.jsx)(u.a,{icon:w.a})}),Object(s.jsx)("button",{onClick:this.decreaseColumns,title:"Decrease columns",disabled:this.state.columnSpan<=1,children:Object(s.jsx)(u.a,{icon:w.c})})]}),Object(s.jsx)("button",{onClick:this.close,title:"Close",children:Object(s.jsx)(u.a,{icon:w.e})})]});const{outerWidth:h,outerHeight:r}=t.viewSize,c=h*n,l=r*i;this.state={rowSpan:i,columnSpan:n,canResizeRows:a,canResizeColumns:o,rowlimit:12,columnLimit:2,outerWidth:h,outerHeight:r,viewHeight:l,viewWidth:c,margin:e,width:h*n-e.left-e.right,height:r*i-e.top-e.bottom}}resizeComponent(t={}){const{outerWidth:e,outerHeight:i}=this.props.viewSize,{outerWidth:s,outerHeight:n,margin:a,rowSpan:o,columnSpan:h}=this.state;if(s!==e||n!==i){const s=e*h,n=i*o;this.setState({...t,outerWidth:e,outerHeight:i,viewWidth:s,viewHeight:n,width:e*h-a.left-a.right,height:i*o-a.top-a.bottom},this.onResize)}}}var v=i(42),g=i(4);i(40),i(36),i(12),i(37);function j(t,e,i,s,n,a){t.beginPath(),t.moveTo(e,i),t.lineTo(e,i+n),t.lineTo(e+s,i+(n/2+a/2)),t.lineTo(e+s,i+(n/2-a/2)),t.closePath(),t.fill()}class b extends p{constructor(t){super(t,{top:45,right:30,bottom:60,left:65}),this.componentDidMount=()=>this.initialize(),this.onResize=()=>this.initialize(),this.initialize=()=>{const{width:t,height:e,yAxisLabelType:i}=this.state,s=.25*e,n=Object(m.a)(this.svg);n.selectAll("*").remove();const a=Object(r.a)().range([2,t]),o=Object(r.a)().range([2,t]),h=Object(r.a)().range([e,s+25]),c=Object(r.a)().range([s,0]),l=Object(d.a)(a),u=Object(d.b)(h);"note"===i?u.tickFormat((t=>{var e;return null===(e=g.Midi.getMidiNoteByNr(t))||void 0===e?void 0:e.label})):u.tickFormat((t=>Math.floor(t)));const w=n.append("g").attr("class","axis").attr("transform",`translate(0, ${e})`).call(l),p=n.append("g").attr("class","axis").call(u);n.append("text").attr("class","yAxisLabel").text("Pitch").attr("transform",`rotate(90) translate(${(e+s)/2}, 45)`),function(t){var e=window.devicePixelRatio||1,i=t.getBoundingClientRect();t.width=i.width*e,t.height=i.height*e;var s=t.getContext("2d");s.scale(e,e)}(this.canvas),this.setState({initialized:!0,svg:n,x:a,xOv:o,y:h,yOv:c,xAxis:l,yAxis:u,xAxisEl:w,yAxisEl:p,overviewHeight:s},(()=>this.draw(this,0)))},this.drawNotes=(t,e,i,s,n,a)=>{const{width:o,margin:h}=this.state,c=Object(r.a)().domain([0,127]).range([.1*i,i]);for(let r of e){const e=s(r.start),i=s(null===r.end?a:r.end);if(i<0||e>o)continue;const l=h.left+e,d=c(r.velocity);j(t,l,h.top+n(r.pitch)-d/2,Math.max(i-e,1),d,d/2)}},this.draw=(t,e)=>{const{viewWidth:i,viewHeight:s,margin:n,width:a,height:o,overviewHeight:h,x:r,xOv:d,y:m,yOv:u,xAxis:w,yAxis:p,xAxisEl:g,yAxisEl:j,showAllTime:b}=t.state,{midiLiveData:x}=t.props,O=x,f=t.canvas.getContext("2d");f.clearRect(0,0,i,s);const S=e/1e3,z=[0,S];d.domain(z),b?r.domain(z):r.domain([S-20,S]),g.call(w);const[C,R]=Object(c.a)(O,(t=>t.pitch));m.domain([+C-1,+R+1]),u.domain([+C-1,+R+1]),j.call(p);const y=Array.from(Object(l.a)(O,(t=>t.channel))).map((t=>t[1])),N=v.a,A=o/(R-C+3),L=h/(R-C+1);y.forEach(((e,i)=>{f.fillStyle=N[i%N.length],t.drawNotes(f,e,A,r,m,S),t.drawNotes(f,e,L,d,u,S)})),f.fillStyle="#888",f.fillRect(n.left,n.top+h+12,a,1),function(t,e,i,s){t.clearRect(0,e.top,e.left,s),t.clearRect(e.left+i,e.top,e.right,s)}(f,n,a,o),requestAnimationFrame((t=>this.draw(this,t)))},this.state={...this.state,overviewHeight:40,showAllTime:!1,yAxisLabelType:"pitch",boxHeight:null,notes:[],liveNotes:[]}}componentDidUpdate(){this.resizeComponent()}render(){const{viewWidth:t,viewHeight:e,margin:i}=this.state;return Object(s.jsxs)("div",{className:"View PitchTimeChart",style:{gridArea:`span ${this.state.rowSpan} / span ${this.state.columnSpan}`},children:[Object(s.jsx)("canvas",{className:"ViewCanvas",ref:t=>this.canvas=t,style:{width:t,height:e}}),Object(s.jsxs)("svg",{width:t,height:e,children:[Object(s.jsx)("text",{className:"heading",x:t/2,y:20,children:"Note-Time Chart for WebMIDI"}),Object(s.jsx)("g",{ref:t=>this.svg=t,transform:`translate(${i.left}, ${i.top})`}),Object(s.jsx)("text",{className:"yAxisLabel",x:t/2,y:e-15,children:"Time in seconds"})]}),Object(s.jsxs)("div",{className:"viewControls",children:[Object(s.jsx)("div",{children:Object(s.jsxs)("select",{title:"Y-axis labels",onChange:t=>this.setState({yAxisLabelType:t.target.value},this.initialize),children:[Object(s.jsx)("option",{value:"pitch",children:"MIDI note"}),Object(s.jsx)("option",{value:"note",children:"Note name"})]})}),Object(s.jsx)("div",{children:Object(s.jsxs)("button",{title:"Toggles between showing the whole time or last 20 seconds",onClick:()=>this.setState({showAllTime:!this.state.showAllTime}),children:[Object(s.jsx)(u.a,{icon:this.state.showAllTime?w.g:w.f}),"\xa0 Show whole time"]})}),Object(s.jsxs)("div",{children:[this.props.midiLiveData.length," notes"]})]})]})}}var x=i(13);class O extends n.Component{constructor(t){super(t),this.onResize=()=>{this.setState({viewSize:{outerWidth:Math.floor(window.innerWidth-20),outerHeight:Math.floor(window.innerHeight-100)}})},this.getMidiLiveData=()=>this.state.midiLiveData,this.setMidiLiveData=t=>{this.state.midiLiveData=t,this.setState({midiLiveData:t})},this.addCurrentNote=t=>{const e=new Map(this.state.currentNotes);e.set(t.pitch,t),this.setState({currentNotes:e})},this.removeCurrentNote=t=>{const e=new Map(this.state.currentNotes);e.delete(t),this.setState({currentNotes:e})},new g.MidiInputManager(this.getMidiLiveData,this.setMidiLiveData,this.addCurrentNote,this.removeCurrentNote),this.state={viewSize:{outerWidth:800,outerHeight:600},midiLiveData:[]}}componentDidMount(){window.addEventListener("resize",this.onResize,!1),this.onResize()}render(){const t=this.state;return Object(s.jsxs)("div",{className:"App dark",children:[Object(s.jsx)(b,{name:"Note-Time Chart",viewSize:t.viewSize,midiLiveData:t.midiLiveData}),Object(s.jsx)("div",{className:"githubLink",children:Object(s.jsxs)("a",{href:"https://github.com/fheyen/midi-live-vis",children:[Object(s.jsx)(u.a,{icon:x.a}),"\xa0 https://github.com/fheyen/midi-live-vis"]})})]})}}h.a.render(Object(s.jsx)(a.a.StrictMode,{children:Object(s.jsx)(O,{})}),document.getElementById("root"))}},[[28,1,2]]]);
//# sourceMappingURL=main.b04a370b.chunk.js.map