(this["webpackJsonpmidi-live-vis"]=this["webpackJsonpmidi-live-vis"]||[]).push([[0],{17:function(t,e,i){t.exports=i(28)},22:function(t,e,i){},28:function(t,e,i){"use strict";i.r(e);var a=i(0),s=i.n(a),n=i(12),o=i.n(n),r=(i(22),i(7)),l=i(6),c=i(39),h=i(35),m=i(41),d=i(10),u=i(38),w=i(2),p=i(4);class v extends a.PureComponent{constructor(t,e={top:0,right:0,bottom:0,left:0},i=1,a=1,n=!0,o=!0){super(t),this.onResize=()=>{},this.increaseRows=()=>{const t=this.state,e=t.rowSpan,i=t.rowlimit,a=t.margin,s=t.canResizeRows,n=this.props.viewSize.outerHeight;if(!s)return;if(e>=i)return;const o=e+1,r=n*o;this.setState({rowSpan:o,viewHeight:r,height:r-a.top-a.bottom},this.onResize)},this.decreaseRows=()=>{const t=this.state,e=t.rowSpan,i=t.margin,a=t.canResizeRows,s=this.props.viewSize.outerHeight;if(!a)return;if(e<=1)return;const n=e-1,o=s*n;this.setState({rowSpan:n,viewHeight:o,height:o-i.top-i.bottom},this.onResize)},this.increaseColumns=()=>{const t=this.state,e=t.columnSpan,i=t.columnLimit,a=t.margin,s=t.canResizeColumns,n=this.props.viewSize.outerWidth;if(!s)return;if(e>=i)return;const o=e+1,r=n*o;this.setState({columnSpan:o,viewWidth:r,width:r-a.left-a.right},this.onResize)},this.decreaseColumns=()=>{const t=this.state,e=t.columnSpan,i=t.margin,a=t.canResizeColumns,s=this.props.viewSize.outerWidth;if(!a)return;if(e<=1)return;const n=e-1,o=s*n;this.setState({columnSpan:n,viewWidth:o,width:o-i.left-i.right},this.onResize)},this.close=()=>{const t=this.props,e=t.toggleView,i=t.name;e&&i&&e(i)},this.getSizeControlHTML=()=>s.a.createElement("div",{className:"sizeControl"},this.state.canResizeRows&&s.a.createElement("span",null,s.a.createElement("button",{onClick:this.increaseRows,title:"Increase rows",disabled:this.state.rowSpan>=this.state.rowlimit},s.a.createElement(w.a,{icon:p.b})),s.a.createElement("button",{onClick:this.decreaseRows,title:"Decrease rows",disabled:this.state.rowSpan<=1},s.a.createElement(w.a,{icon:p.d}))),this.state.canResizeColumns&&s.a.createElement("span",null,s.a.createElement("button",{onClick:this.increaseColumns,title:"Increase columns",disabled:this.state.columnSpan>=this.state.columnLimit},s.a.createElement(w.a,{icon:p.a})),s.a.createElement("button",{onClick:this.decreaseColumns,title:"Decrease columns",disabled:this.state.columnSpan<=1},s.a.createElement(w.a,{icon:p.c}))),s.a.createElement("button",{onClick:this.close,title:"Close"},s.a.createElement(w.a,{icon:p.e})));const r=t.viewSize,l=r.outerWidth,c=r.outerHeight,h=l*a,m=c*i;this.state={rowSpan:i,columnSpan:a,canResizeRows:n,canResizeColumns:o,rowlimit:12,columnLimit:2,outerWidth:l,outerHeight:c,viewHeight:m,viewWidth:h,margin:e,width:l*a-e.left-e.right,height:c*i-e.top-e.bottom}}resizeComponent(t={}){const e=this.props.viewSize,i=e.outerWidth,a=e.outerHeight,s=this.state,n=s.outerWidth,o=s.outerHeight,l=s.margin,c=s.rowSpan,h=s.columnSpan;if(n!==i||o!==a){const e=i*h,s=a*c;this.setState(Object(r.a)({},t,{outerWidth:i,outerHeight:a,viewWidth:e,viewHeight:s,width:i*h-l.left-l.right,height:a*c-l.top-l.bottom}),this.onResize)}}}var g=i(42),f=i(3);i(40),i(36),i(13),i(37);function b(t,e,i,a,s,n){t.beginPath(),t.moveTo(e,i),t.lineTo(e,i+s),t.lineTo(e+a,i+(s/2+n/2)),t.lineTo(e+a,i+(s/2-n/2)),t.closePath(),t.fill()}class S extends v{constructor(t){super(t,{top:45,right:30,bottom:60,left:65}),this.componentDidMount=()=>this.initialize(),this.onResize=()=>this.initialize(),this.initialize=()=>{const t=this.state,e=t.width,i=t.height,a=t.yAxisLabelType,s=.25*i,n=Object(u.a)(this.svg);n.selectAll("*").remove();const o=Object(c.a)().range([2,e]),r=Object(c.a)().range([2,e]),l=Object(c.a)().range([i,s+25]),h=Object(c.a)().range([s,0]),m=Object(d.a)(o),w=Object(d.b)(l);"note"===a?w.tickFormat(t=>{var e;return null===(e=f.Midi.getMidiNoteByNr(t))||void 0===e?void 0:e.label}):w.tickFormat(t=>Math.floor(t));const p=n.append("g").attr("class","axis").attr("transform","translate(0, ".concat(i,")")).call(m),v=n.append("g").attr("class","axis").call(w);n.append("text").attr("class","yAxisLabel").text("Pitch").attr("transform","rotate(90) translate(".concat((i+s)/2,", ",45,")")),function(t){var e=window.devicePixelRatio||1,i=t.getBoundingClientRect();t.width=i.width*e,t.height=i.height*e;var a=t.getContext("2d");a.scale(e,e)}(this.canvas),this.setState({initialized:!0,svg:n,x:o,xOv:r,y:l,yOv:h,xAxis:m,yAxis:w,xAxisEl:p,yAxisEl:v,overviewHeight:s},()=>this.draw(this,0))},this.drawNotes=(t,e,i,a,s,n)=>{const o=this.state,r=o.width,l=o.margin,h=Object(c.a)().domain([0,127]).range([.1*i,i]);for(let c of e){const e=a(c.start),i=a(null===c.end?n:c.end);if(i<0||e>r)continue;const o=l.left+e,m=h(c.velocity);b(t,o,l.top+s(c.pitch)-m/2,Math.max(i-e,1),m,m/2)}},this.draw=(t,e)=>{const i=t.state,a=i.viewWidth,s=i.viewHeight,n=i.margin,o=i.width,r=i.height,c=i.overviewHeight,d=i.x,u=i.xOv,w=i.y,p=i.yOv,v=i.xAxis,f=i.yAxis,b=i.xAxisEl,S=i.yAxisEl,E=i.showAllTime,x=t.props.midiLiveData,z=t.canvas.getContext("2d");z.clearRect(0,0,a,s);const C=e/1e3,R=[0,C];u.domain(R),E?d.domain(R):d.domain([C-20,C]),b.call(v);const y=Object(h.a)(x,t=>t.pitch),N=Object(l.a)(y,2),A=N[0],L=N[1];w.domain([+A-1,+L+1]),p.domain([+A-1,+L+1]),S.call(f);const H=Array.from(Object(m.a)(x,t=>t.channel)).map(t=>t[1]),D=g.a,M=r/(L-A+3),T=c/(L-A+1);H.forEach((e,i)=>{z.fillStyle=D[i%D.length],t.drawNotes(z,e,M,d,w,C),t.drawNotes(z,e,T,u,p,C)}),z.fillStyle="#888",z.fillRect(n.left,n.top+c+12,o,1),function(t,e,i,a){t.clearRect(0,e.top,e.left,a),t.clearRect(e.left+i,e.top,e.right,a)}(z,n,o,r),requestAnimationFrame(t=>this.draw(this,t))},this.state=Object(r.a)({},this.state,{overviewHeight:40,showAllTime:!1,yAxisLabelType:"pitch",boxHeight:null,notes:[],liveNotes:[]})}componentDidUpdate(){this.resizeComponent()}render(){const t=this.state,e=t.viewWidth,i=t.viewHeight,a=t.margin;return s.a.createElement("div",{className:"View PitchTimeChart",style:{gridArea:"span ".concat(this.state.rowSpan," / span ").concat(this.state.columnSpan)}},s.a.createElement("canvas",{className:"ViewCanvas",ref:t=>this.canvas=t,style:{width:e,height:i}}),s.a.createElement("svg",{width:e,height:i},s.a.createElement("text",{className:"heading",x:e/2,y:20},"Note-Time Chart for WebMIDI"),s.a.createElement("g",{ref:t=>this.svg=t,transform:"translate(".concat(a.left,", ").concat(a.top,")")}),s.a.createElement("text",{className:"yAxisLabel",x:e/2,y:i-15},"Time in seconds")),s.a.createElement("div",{className:"viewControls"},s.a.createElement("div",null,s.a.createElement("select",{title:"Y-axis labels",onChange:t=>this.setState({yAxisLabelType:t.target.value},this.initialize)},s.a.createElement("option",{value:"pitch"},"MIDI note"),s.a.createElement("option",{value:"note"},"Note name"))),s.a.createElement("div",null,s.a.createElement("button",{title:"Toggles between showing the whole time or last 20 seconds",onClick:()=>this.setState({showAllTime:!this.state.showAllTime})},s.a.createElement(w.a,{icon:this.state.showAllTime?p.g:p.f}),"\xa0 Show whole time")),s.a.createElement("div",null,this.props.midiLiveData.length," notes")))}}var E=i(14);class x extends a.Component{constructor(t){super(t),this.onResize=()=>{this.setState({viewSize:{outerWidth:Math.floor(window.innerWidth-20),outerHeight:Math.floor(window.innerHeight-100)}})},this.getMidiLiveData=()=>this.state.midiLiveData,this.setMidiLiveData=t=>{this.state.midiLiveData=t,this.setState({midiLiveData:t})},this.addCurrentNote=t=>{const e=new Map(this.state.currentNotes);e.set(t.pitch,t),this.setState({currentNotes:e})},this.removeCurrentNote=t=>{const e=new Map(this.state.currentNotes);e.delete(t),this.setState({currentNotes:e})},new f.MidiInputManager(this.getMidiLiveData,this.setMidiLiveData,this.addCurrentNote,this.removeCurrentNote),this.state={viewSize:{outerWidth:800,outerHeight:600},midiLiveData:[]}}componentDidMount(){window.addEventListener("resize",this.onResize,!1),this.onResize()}render(){const t=this.state;return s.a.createElement("div",{className:"App dark"},s.a.createElement(S,{name:"Note-Time Chart",viewSize:t.viewSize,midiLiveData:t.midiLiveData}),s.a.createElement("div",{className:"githubLink"},s.a.createElement("a",{href:"https://github.com/fheyen/midi-live-vis"},s.a.createElement(w.a,{icon:E.a}),"\xa0 https://github.com/fheyen/midi-live-vis")))}}o.a.render(s.a.createElement(x,null),document.getElementById("root"))}},[[17,1,2]]]);
//# sourceMappingURL=main.6ecf696c.chunk.js.map